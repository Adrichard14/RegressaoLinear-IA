<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.2/full/pyodide.js"></script>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <title>Diabetes Prediction</title>
    <py-env>
        - pandas
        - paths:
          - /diabetes.txt
      </py-env>
    <py-config>
        packages = [
          "matplotlib",
          "pandas",
          "numpy",
          "scikit-learn"
        ]
        plugins = [
          "https://pyscript.net/latest/plugins/python/py_tutor.py"
        ]
    </py-config>
</head>
<body>
    <h1>Diabetes Prediction</h1>
    <py-script>
        import pandas as pd
        import numpy as np
        from sklearn.preprocessing import PolynomialFeatures
        from sklearn.model_selection import train_test_split
        from sklearn.linear_model import LinearRegression
        from sklearn.metrics import mean_squared_error, r2_score

        # Carregar a base de dados do diabetes a partir do link
        data = pd.read_csv('diabetes.txt', sep='\t')

        # Identificar as variáveis relevantes para a progressão da diabetes
        X = data[['BMI','BP', 'S4', 'S5']]  # Variáveis independentes
        y = data['Y']  # Variável dependente

        # Dividir os dados em conjunto de treinamento e teste
        X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

        # Criar um modelo de regressão linear
        model = LinearRegression()

        # Pré-processamento dos dados de entrada
        regr_quad = PolynomialFeatures(degree=2, include_bias=False)
        X_train_poly = regr_quad.fit_transform(X_train)
        X_test_poly = regr_quad.transform(X_test)

        # Treinar o modelo usando o conjunto de treinamento
        model.fit(X_train_poly, y_train)

        def make_prediction(s1, s2, s3, s4):
            # Pré-processamento dos dados de entrada
            input_data = [[s1, s2, s3, s4]]
            input_data_poly = regr_quad.transform(input_data)

            # Fazer a previsão da progressão da diabetes usando o modelo treinado
            predicted_progression = model.predict(input_data_poly)[0]

            return predicted_progression

        # Função para lidar com a interação do usuário
        def handle_user_input():
            while True:
                try:
                    s1 = float(input("Idade do paciente: "))
                    s2 = float(input("Sexo do paciente (1 - feminino, 2 - masculino): "))
                    s3 = float(input("Índice de massa corporal (BMI): "))
                    s4 = float(input("Pressão arterial média: "))

                    predicted_progression = make_prediction(s1, s2, s3, s4)

                    print(f"Previsão da progressão da diabetes: {predicted_progression}\n")

                    choice = input("Deseja fazer outra previsão? (S/N): ")
                    if choice.upper() != 'S':
                        break
                except ValueError:
                    print("Por favor, insira um valor numérico válido.\n")

        handle_user_input()
    </py-script>
</body>
</html>